package com.github.t1.webresource;

import java.util.List;
import javax.ejb.Stateless;
import javax.persistence.*;
import javax.ws.rs.*;
import javax.ws.rs.core.*;
import javax.ws.rs.core.Response.Status;

@Path("/")
@Stateless
public class TestEntityWebResource {
    @PersistenceContext
    private EntityManager em;

    @GET
    @Path("testentitys")
    public List<TestEntity> getTestEntitys() {
        return em.createQuery("FROM TestEntity ORDER BY id", TestEntity.class).getResultList();
    }

    @GET
    @Path("testentity/{id}")
    public Response getTestEntity(@PathParam("id") long id) {
        TestEntity result = em.find(TestEntity.class, id);
        if (result == null) {
            return Response.status(Status.NOT_FOUND).build();
        }
        return Response.ok(result).build();
    }

    @POST
    @Path("testentitys")
    public Response createTestEntity(TestEntity testentity, @Context UriInfo uriInfo) {
        em.persist(testentity);
        em.flush();

        UriBuilder builder = uriInfo.getBaseUriBuilder();
        builder.path("testentity").path(Long.toString(testentity.getId()));
        return Response.created(builder.build()).build();
    }

    @PUT
    @Path("testentity/{id}")
    public Response updateTestEntity(@PathParam("id") long id, TestEntity testentity) {
        if (testentity.getId() == null) {
            testentity.setId(id);
        } else if (id != testentity.getId()) {
            String message = "id conflict! path=" + id + ", body=" + testentity.getId() + ".\n"
                + "either leave the id in the body null or set it to the same id";
            return Response.status(Status.BAD_REQUEST).entity(message).build();
        }
        TestEntity result = em.merge(testentity);
        if (result == null) {
            return Response.status(Status.NOT_FOUND).build();
        }
        return Response.ok(result).build();
    }

    @DELETE
    @Path("testentity/{id}")
    public Response deleteTestEntity(@PathParam("id") long id) {
        TestEntity result = em.find(TestEntity.class, id);
        if (result == null) {
            return Response.status(Status.NOT_FOUND).build();
        }
        em.remove(result);
        return Response.ok(result).build();
    }
}
